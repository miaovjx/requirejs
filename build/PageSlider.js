define(["zepto","jweixin"],function(t,e){function i(e){if(t.extend(this,l,e),this.pages.length<=0)throw new Error("target para not pass");this.target=this.pages.eq(0).parent(),this.length=this.pages.length,this.moveTo=i.prototype.moveTo,this.index=0,this.curPage=this.pages.eq(this.index),this.timer=null,r=this.gestureFollowing,"vertical"!==this.direction&&"v"!==this.direction||(this.direction="v"),"horizontal"!==this.direction&&"h"!==this.direction||(this.direction="h"),this.length<1||this._init()}var n,a,s,o,r,c,h,l={direction:"vertical",currentClass:"current",gestureFollowing:!1,hasDot:!1,rememberLastVisited:!1,preventDefault:!0,animationPlayOnce:!1,dev:!1,musicUrl:!1,shareUrl:"https://yidian.weiyihui.com.cn/weixinshare/index.php",baseUrl:"",onSwipeUp:function(){},checkMobile:function(t){if(11!=t.length)return!1;var e=/^0?1(3|4|5|7|8|9)\d{9}$/;return e.test(t)},onSwipeDown:function(){},onSwipeLeft:function(){},onSwipeRight:function(){},oninit:function(){},onbeforechange:function(){},onchange:function(){var e=this.index+1,i=t(window).height();1==e||10==e&&t(".redwindow").animate({height:i},5e3,function(){t(".p10_1").removeClass("none").addClass("zoomIn"),t(".p10_1").on("animationend webkitAnimationEnd",function(){setTimeout(function(){t(".p10_1").addClass("none"),t(".p10_2 ").animate({top:0},4e3,function(){t(".share_btn").removeClass("none"),t(".p10_3 ").addClass("tada"),t(".p10_4 ").addClass("wobble")})},2e3)})})}},d=document.documentElement.clientWidth,u=document.documentElement.clientHeight;window.screen.height;i.prototype={_init:function(){var e=this;this.target.css("-webkit-transition","-webkit-transform 0.5s ease"),this.pages.each(function(){var e=t(this),i=e.wrapInner('<div class="PageSlider__wraper"></div>').find(".PageSlider__wraper"),n=i.height();n>u&&(e.data("height",n),e.css("overflow","auto")),i.children().unwrap()}),"h"===this.direction&&(this.target.css("position","relative"),this.pages.each(function(e){t(this).css({position:"absolute",left:100*e+"%",top:0})})),this.hasDot&&this._createDot(),e._bindAnimation(),this.target.on("touchstart",function(t){e._startHandle(t)}),this.target.on("touchmove",function(t){e._moveHandle(t)}),this.target.on("touchend",function(t){e._endHandle(t)}),this.rememberLastVisited&&(this.lastVisitedIndex=this._getLastVisited()),this.target.css("-webkit-transform","translate(0, 0)"),this.pages.eq(0).addClass(this.currentClass),this.oninit.call(this),this._dev(),this._orientationTip(),this._initWeixin(this.shareUrl),this._bgMusic(),this.smallScreen()},smallScreen:function(){},_startHandle:function(t){var e=t.changedTouches[0];if("running"===s)return void t.preventDefault();o="v"===this.direction?e.clientY:e.clientX,n=this.curPage.data("lock-next"),a=this.curPage.data("lock-prev"),this.curPage[0].pageScrollHeight=this.curPage.data("height"),this.curPage[0].pageScrollHeight&&(r&&(this.gestureFollowing=!1),this.preventDefault=!1,h=u+this.curPage.scrollTop()),this.gestureFollowing&&(c=-this.index*("v"===this.direction?u:d))},_moveHandle:function(t){var e,i,r=t.changedTouches[0];return"running"===s?void t.preventDefault():(i="v"===this.direction?r.clientY:r.clientX,e=i-o,this.curPage[0].pageScrollHeight&&(e>0&&h===u&&t.preventDefault(),e<0&&h===this.curPage[0].pageScrollHeight&&t.preventDefault()),this.gestureFollowing?this.index<=0&&i>o||this.index>=this.length-1&&i<o?void t.preventDefault():e>0&&a||e<0&&n?void t.preventDefault():(e=c+e+"px",this._removeTransition(),"v"===this.direction?this.target.css("-webkit-transform","translate(0, "+e+")"):this.target.css("-webkit-transform","translate("+e+", 0)"),void this._preventDefault(t)):void this._preventDefault(t))},_endHandle:function(t){var e,i,r=t.changedTouches[0];if("running"===s)return void t.preventDefault();if(i="v"===this.direction?r.clientY:r.clientX,e=i-o,this._setTransition(),e>0&&("v"===this.direction?this.onSwipeDown.call(this):this.onSwipeRight.call(this),!a)){if(this.curPage[0].pageScrollHeight&&h>u)return;e>20?this.prev():this.moveTo(this.index)}if(e<0&&("v"===this.direction?this.onSwipeUp.call(this):this.onSwipeLeft.call(this),!n)){if(this.curPage[0].pageScrollHeight&&h<this.curPage[0].pageScrollHeight)return;e<-20?this.next():this.moveTo(this.index)}},moveTo:function(t,e){var i,n=this;if(s="running",e=e||!1,t>=this.length||t<0)return void(s="end");e&&this._removeTransition(),this.onbeforechange.call(this),"v"===this.direction&&(i=100*-t+"%",this.target.css("-webkit-transform","translate(0, "+i+")")),"h"===this.direction&&(i=100*-t+"%",this.target.css("-webkit-transform","translate("+i+", 0)")),clearTimeout(this.timer),this.timer=setTimeout(function(){n._currentClass(t),n.prevIndex=n.index,n.index=t,n.onchange.call(n),e&&n._setTransition(),n.curPage&&n.curPage[0].pageScrollHeight&&(r&&(n.gestureFollowing=!0),n.preventDefault=!0,n.curPage.scrollTop(0)),n.curPage=n.pages.eq(n.index),n.rememberLastVisited&&n._saveLastVisited(),s="end",clearTimeout(this.timer)},500)},prev:function(){this.moveTo(this.index-1)},next:function(){this.moveTo(this.index+1)},_setTransition:function(){this.target.css("-webkit-transition","-webkit-transform 0.5s ease")},_removeTransition:function(){this.target.css("-webkit-transition","none")},_currentClass:function(t){var e=this.currentClass;this.pages.eq(t).addClass(e),t===this.index||this.animationPlayOnce||this.pages.eq(this.index).removeClass(e)},_createDot:function(){for(var e="",i=0;i<this.length;i++)e+="<li>"+(i+1)+"</li>";t(e).appendTo(this.target).wrapAll('<ul class="dot-list">')},_saveLastVisited:function(){var t=window.localStorage;t&&t.setItem("pageSliderIndex",this.index)},_getLastVisited:function(){var t=window.localStorage;if(t)return this.cacheIndex=t.getItem("pageSliderIndex"),parseInt(this.cacheIndex)},_bindAnimation:function(){var e=this,i="<style>";t("[data-animation]").each(function(n){var a=t(this),s=a.data("animation"),o=s.name,r=s.duration||500,c=s.delay||0,h=s["timing-function"]||"ease",l=s["fill-mode"]||"both",d=s["iteration-count"]||1,u=s.direction||"normal";a.data("animationid",++n),i+="."+e.currentClass+' [data-animationid="'+n+'"]{-webkit-animation-name: '+o+";-webkit-animation-duration: "+r+"ms;-webkit-animation-delay: "+c+"ms;-webkit-animation-timing-function: "+h+";-webkit-animation-fill-mode: "+l+";-webkit-animation-iteration-count: "+d+";-webkit-animation-direction: "+u+";}"}),t("head").eq(0).append(i)},_preventDefault:function(t){this.preventDefault&&t.preventDefault()},_dev:function(){!1!==this.dev&&this.moveTo(this.dev,!0)},_orientationTip:function(){t("#qr-box__img").length||t("body").append("");var e=t('meta[name="wxm:link"]').attr("content");e||(e=window.location.href),e=encodeURIComponent(e),t("#qr-box__img").attr("style","background-image:url(https://game.weixin.qq.com/cgi-bin/comm/qrcode?s=10&m=1&d="+e+")");var i=t('meta[name="wxm:img_url"]').attr("content");i&&t("#qr-box__thumb").attr("style","background-image:url("+i+")")},_bgMusic:function(){if(this.musicUrl){var e='<a class="u-btn-play rotate"></a><audio id="bgmusic" src="'+this.musicUrl+'" preload="auto" style="visibility: hidden;" loop="loop"></audio>';t("body").append(e);var i=document.getElementById("bgmusic");i.play(),document.addEventListener("WeixinJSBridgeReady",function(){i.play()},!1),t(".u-btn-play").live("tap",function(){i.paused?(i.play(),t(this).removeClass("zanting").addClass("rotate")):(i.pause(),t(this).removeClass("rotate").addClass("zanting"))})}else console.log("不需要背景音乐？")},_initWeixin:function(i){var n=location.href.split("#")[0];t.ajax({url:i,type:"get",dataType:"jsonp",jsonp:"jsoncallback",data:{url:n},success:function(t){1==t.error||e.config({debug:!1,appId:t.appId,timestamp:t.timestamp,nonceStr:t.nonceStr,signature:t.signature,jsApiList:["checkJsApi","onMenuShareTimeline","onMenuShareAppMessage","onMenuShareQQ","onMenuShareWeibo","closeWindow"]})},error:function(t){}})},_loadimg:function(e,i){for(var n=this.baseUrl,a=new PxLoader,s=e,o=t(".load .num"),r=s.length,c=0;c<r;c++){var h=new PxLoaderImage(n+s[c]);h.imageNumber=c+1,a.add(h)}a.addProgressListener(function(t){var e=t.completedCount,i=parseInt(100*e/r);parseInt(i/100);o.text(i+"%")}),a.addCompletionListener(i),a.start()},wxShare:function(t,i,n,a,s){e.ready(function(){e.onMenuShareTimeline({title:i,link:a,imgUrl:s,success:function(){},cancel:function(){}}),e.onMenuShareAppMessage({title:t,desc:i,link:a,imgUrl:s,type:"",dataUrl:"",success:function(){},cancel:function(){}})})}},window.PageSlider=i});