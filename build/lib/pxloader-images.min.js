/*! PxLoader v1.0.0 | http://thinkpixellab.com/PxLoader */

function PxLoaderImage(t,e,n,r){var i=this,o=null;this.img=new Image,void 0!==r&&(this.img.crossOrigin=r),this.tags=e,this.priority=n;var s=function(){"complete"===i.img.readyState&&(l(),o.onLoad(i))},a=function(){l(),o.onLoad(i)},u=function(){l(),o.onError(i)},l=function(){i.unbind("load",a),i.unbind("readystatechange",s),i.unbind("error",u)};this.start=function(e){o=e,i.bind("load",a),i.bind("readystatechange",s),i.bind("error",u),i.img.src=t},this.checkStatus=function(){i.img.complete&&(l(),o.onLoad(i))},this.onTimeout=function(){l(),i.img.complete?o.onLoad(i):o.onTimeout(i)},this.getName=function(){return t},this.bind=function(t,e){i.img.addEventListener?i.img.addEventListener(t,e,!1):i.img.attachEvent&&i.img.attachEvent("on"+t,e)},this.unbind=function(t,e){i.img.removeEventListener?i.img.removeEventListener(t,e,!1):i.img.detachEvent&&i.img.detachEvent("on"+t,e)}}!function(t){function e(t){t=t||{},this.settings=t,null==t.statusInterval&&(t.statusInterval=5e3),null==t.loggingDelay&&(t.loggingDelay=2e4),null==t.noProgressTimeout&&(t.noProgressTimeout=1/0);var e,r=[],i=[],o=Date.now(),s={QUEUED:0,WAITING:1,LOADED:2,ERROR:3,TIMEOUT:4},a=function(t){return null==t?[]:Array.isArray(t)?t:[t]};this.add=function(t){t.tags=new n(t.tags),null==t.priority&&(t.priority=1/0),r.push({resource:t,status:s.QUEUED})},this.addProgressListener=function(t,e){i.push({callback:t,tags:new n(e)})},this.addCompletionListener=function(t,e){i.push({tags:new n(e),callback:function(e){e.completedCount===e.totalCount&&t(e)}})};var u=function(t){t=a(t);var e=function(e){for(var n=e.resource,r=1/0,i=0;i<n.tags.length;i++)for(var o=0;o<Math.min(t.length,r)&&!(n.tags.all[i]===t[o]&&r>o&&0===(r=o))&&0!==r;o++);return r};return function(t,n){var r=e(t),i=e(n);return i>r?-1:r>i?1:t.priority<n.priority?-1:t.priority>n.priority?1:0}};this.start=function(t){e=Date.now();var n=u(t);r.sort(n);for(var i=0,o=r.length;o>i;i++){var a=r[i];a.status=s.WAITING,a.resource.start(this)}setTimeout(l,100)};var l=function(){for(var e=!1,n=Date.now()-o,i=n>=t.noProgressTimeout,a=n>=t.loggingDelay,u=0,c=r.length;c>u;u++){var g=r[u];g.status===s.WAITING&&(g.resource.checkStatus&&g.resource.checkStatus(),g.status===s.WAITING&&(i?g.resource.onTimeout():e=!0))}a&&e&&h(),e&&setTimeout(l,t.statusInterval)};this.isBusy=function(){for(var t=0,e=r.length;e>t;t++)if(r[t].status===s.QUEUED||r[t].status===s.WAITING)return!0;return!1};var c=function(t,e){var n,a,u,l=null;for(n=0,a=r.length;a>n;n++)if(r[n].resource===t){l=r[n];break}if(null!=l&&l.status===s.WAITING)for(l.status=e,o=Date.now(),t.tags.length,n=0,a=i.length;a>n;n++)u=i[n],(0===u.tags.length||t.tags.intersects(u.tags))&&g(l,u)};this.onLoad=function(t){c(t,s.LOADED)},this.onError=function(t){c(t,s.ERROR)},this.onTimeout=function(t){c(t,s.TIMEOUT)};var g=function(t,e){var n,i,o,a=0,u=0;for(n=0,i=r.length;i>n;n++)o=r[n],!1,(0===e.tags.length||o.resource.tags.intersects(e.tags))&&(u++,(o.status===s.LOADED||o.status===s.ERROR||o.status===s.TIMEOUT)&&a++);e.callback({resource:t.resource,loaded:t.status===s.LOADED,error:t.status===s.ERROR,timeout:t.status===s.TIMEOUT,completedCount:a,totalCount:u})},h=this.log=function(t){if(window.console){var n=Math.round((Date.now()-e)/1e3);window.console.log("PxLoader elapsed: "+n+" sec");for(var i=0,o=r.length;o>i;i++){var a=r[i];if(t||a.status===s.WAITING){var u="PxLoader: #"+i+" "+a.resource.getName();switch(a.status){case s.QUEUED:u+=" (Not Started)";break;case s.WAITING:u+=" (Waiting)";break;case s.LOADED:u+=" (Loaded)";break;case s.ERROR:u+=" (Error)";break;case s.TIMEOUT:u+=" (Timeout)"}a.resource.tags.length>0&&(u+=" Tags: ["+a.resource.tags.all.join(",")+"]"),window.console.log(u)}}}}}function n(t){if(this.all=[],this.first=null,this.length=0,this.lookup={},t){if(Array.isArray(t))this.all=t.slice(0);else if("object"==typeof t)for(var e in t)t.hasOwnProperty(e)&&this.all.push(e);else this.all.push(t);this.length=this.all.length,this.length>0&&(this.first=this.all[0]);for(var n=0;n<this.length;n++)this.lookup[this.all[n]]=!0}}n.prototype.intersects=function(t){if(0===this.length||0===t.length)return!1;if(1===this.length&&1===t.length)return this.first===t.first;if(t.length<this.length)return t.intersects(this);for(var e in this.lookup)if(t.lookup[e])return!0;return!1},"function"==typeof define&&define.amd&&define("PxLoader",[],function(){return e}),t.PxLoader=e}(this),Date.now||(Date.now=function(){return(new Date).getTime()}),Array.isArray||(Array.isArray=function(t){return"[object Array]"===Object.prototype.toString.call(t)}),PxLoader.prototype.addImage=function(t,e,n,r){var i=new PxLoaderImage(t,e,n,r);return this.add(i),i.img},"function"==typeof define&&define.amd&&define("PxLoaderImage",[],function(){return PxLoaderImage});